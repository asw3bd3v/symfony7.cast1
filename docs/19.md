# Turbo: Your Single Page App

Когда я создаю UI, я хочу, чтобы он был красивым, интерактивным и плавным. Лично я предпочитаю не использовать фронтенд-фреймворки вроде React, Vue или Next. Но вы можете... и в этом нет ничего плохого: это отличные инструменты. Кроме того, создание API в Symfony — это здорово!

Одна большая часть модного интерфейса — это удаление полностраничных перезагрузок. Прямо сейчас, когда я щелкаю, смотрите: это быстро, но это полностраничные перезагрузки. Этого не происходит, если вы используете что-то вроде React или Vue.

Чтобы устранить их, мы собираемся использовать другую библиотеку от тех же людей, которые создали Stimulus, называемую Turbo. Turbo может делать много вещей, но ее главная задача — устранить полностраничные обновления. Как и Stimulus, это библиотека JavaScript. И также, как и Stimulus, у Symfony есть пакет, который помогает интегрировать ее.

## Installing Turbo

```
composer require symfony/ux-turbo
```

На этот раз рецепт сделал два интересных изменения. Я вам покажу. Первое в importmap.php: он добавил пакет JavaScript @hotwired/turbo.

importmap.php

```php
return [
// ... lines 17 - 26
    '@hotwired/turbo' => [
        'version' => '7.3.0',
    ],
];
```

Второе изменение в assets/controllers.json. Мы не говорили об этом файле раньше, но он был добавлен рецептом StimulusBundle: это способ активировать контроллеры Stimulus, которые находятся внутри сторонних пакетов.

assets/controllers.json

```json
{
	"controllers": {
		"@symfony/ux-turbo": {
			"turbo-core": {
				"enabled": true,
				"fetch": "eager"
			},
			"mercure-turbo-stream": {
				"enabled": false,
				"fetch": "eager"
			}
		}
	},
	"entrypoints": []
}
```

Итак, PHP-пакет symfony/ux-turbo, который мы только что установили, имеет внутри себя контроллер JavaScript, который называется turbo-core. И поскольку мы включили здесь: true, это означает, что контроллер теперь зарегистрирован и доступен: как если бы он находился в нашем каталоге assets/controllers/.

Сейчас мы не будем использовать этот контроллер напрямую - мы не будем прикреплять его к элементу. Но того факта, что он загружается и регистрируется в Stimulus, достаточно для активации Turbo на нашем сайте.

> Возникла ошибка: An exception has been thrown during the rendering of a template ("Could not find an asset mapper path that points to the "turbo-core" controller in package "symfony/ux-turbo"...

Нужно в bundles.php добавить

```php
return [
    // ...
    Symfony\UX\Turbo\TurboBundle::class => ['all' => true],
];

```

## Full Page Refreshes Gone

Что это значит, черт возьми? Это как магия: обновите страницу, и бац! Полные перезагрузки страницы исчезают! Смотрите сюда: когда я нажимаю «назад», вы не увидите перезагрузки. Бум! Это очень быстро и все происходит через Ajax.

Вот как это работает. Когда мы нажимаем на эту ссылку, Turbo перехватывает нажатие и вместо полной перезагрузки страницы делает вызов Ajax на эту страницу. Этот вызов Ajax возвращает полный HTML для этой страницы, а затем Turbo помещает его на эту страницу.

Эта маленькая вещь превращает наш проект в одностраничное приложение и существенно влияет на скорость работы нашего сайта.

## AJAX Calls & the Web Debug Toolbar / Вызовы AJAX и панель инструментов веб-отладки

Но есть еще кое-что. Я обновлю страницу, чтобы мы могли это увидеть. Всякий раз, когда вы делаете вызов Ajax в приложении Symfony — через Turbo или любым другим способом — панель инструментов отладки Web замечает это. Смотрите прямо здесь, когда я нажимаю. Посмотрите! У нас есть текущий список всех вызовов Ajax, сделанных на этой странице. И если мы хотим увидеть профилировщик для любого из этих запросов Ajax, мы можем нажать на ссылку.

И да... вот мы и здесь. Вот запрос Ajax, который был сделан для домашней страницы. Хотя с Turbo вам даже не нужно полагаться на этот трюк, потому что, когда мы щелкаем, вся эта панель заменяется новой панелью инструментов веб-отладки для страницы.

О, и вот что: в Turbo 8, который уже вышел, ваш сайт будет казаться еще быстрее. Это благодаря новой функции Instant Click. С ней, когда вы наводите курсор на ссылку, Turbo делает Ajax-вызов на эту страницу до того, как вы кликнете. Затем, когда вы кликаете, она загружается мгновенно... или, по крайней мере, имеет фору.

Turbo имеет множество других функций, и мы используем многие из них в нашем LAST Stack Tutorial, где мы создаем интерфейс со всплывающими окнами, модальными окнами, всплывающими уведомлениями и многим другим.

## Turbo Requires Good JavaScript / Turbo требует хорошего JavaScript

Но одно замечание о Turbo. Поскольку полные перезагрузки страниц исчезли, ваш JavaScript должен быть построен таким образом, чтобы справляться с этим. Многие JavaScript ожидают полной перезагрузки страницы... и если HTML внезапно добавляется на страницу без перезагрузки, она ломается. Хорошая новость в том, что если вы пишете свой JavaScript в Stimulus, то все в порядке.

Смотрите. Независимо от того, как мы попадаем на домашнюю страницу, наш JavaScript для закрытия боковой панели продолжает работать.